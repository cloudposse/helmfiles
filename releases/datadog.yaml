repositories:
  # Stable repo of official helm charts
  - name: "stable"
    url: "https://kubernetes-charts.storage.googleapis.com"

releases:

  #######################################################################################
  ## datadog                                                                           ##
  ## Datadog is a hosted infrastructure monitoring platform                            ##
  #######################################################################################

  # DataDog official chart
  # https://github.com/helm/charts/tree/master/stable/datadog
  # https://docs.datadoghq.com/agent/kubernetes/helm/
  - name: "datadog"
    namespace: "monitoring"
    labels:
      chart: "datadog"
      repo: "stable"
      component: "datadog"
      namespace: "monitoring"
      vendor: "datadog"
    chart: "stable/datadog"
    version: { { env "DATADOG_CHART_VERSION" | default "2.3.42" } }
    wait: true
    timeout: { { env "DATADOG_APPLY_TIMEOUT" | default "1800" } }
    atomic: true
    cleanupOnFail: true
    installed: { { env "DATADOG_INSTALLED" | default "true" } }
    createNamespace: { { env "DATADOG_CREATE_NAMESPACE" | default "true" } }
    values:
      - datadog:
          apiKey: { { env "DATADOG_API_KEY" } }
          appKey: { { env "DATADOG_APP_KEY" } }
          logLevel: { { env "DATADOG_LOG_LEVEL" | default "INFO" } }
          logs:
            enabled: { { env "DATADOG_LOGS_ENABLED" | default "false" } }
            containerCollectAll: { { env "DATADOG_LOGS_CONTAINER_COLLECT_ALL" | default "false" } }
          apm:
            enabled: { { env "DATADOG_APM_ENABLED" | default "false" } }
          processAgent:
            enabled: { { env "DATADOG_PROCESS_AGENT_ENABLED" | default "false" } }
            processCollection: { { env "DATADOG_PROCESS_AGENT_PROCESS_COLLECTION" | default "false" } }
          systemProbe:
            enabled: { { env "DATADOG_SYSTEM_PROBE_ENABLED" | default "false" } }
          kubeStateMetricsEnabled: { { env "DATADOG_KUBE_STATE_METRICS_ENABLED" | default "true" } }
          clusterAgent:
            enabled: { { env "DATADOG_CLUSTER_AGENT_ENABLED" | default "true" } }
            replicas: { { env "DATADOG_CLUSTER_AGENT_REPLICA_COUNT" | default "1" } }
            metricsProvider:
              enabled: { { env "DATADOG_CLUSTER_AGENT_METRICS_PROVIDER_ENABLED" | default "false" } }
            clusterChecks:
              enabled: { { env "DATADOG_CLUSTER_AGENT_CLUSTER_CHECKS_ENABLED" | default "true" } }
          collectEvents: { { env "DATADOG_COLLECT_EVENTS_ENABLED" | default "true" } }
          leaderElection: { { env "DATADOG_LEADER_ELECTION_ENABLED" | default "true" } }
