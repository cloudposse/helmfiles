repositories:
  # Get chart from Istio GitHub repo (helm repo deprecated)
  # See https://github.com/aslafy-z/helm-git/issues/6
  - name: "istio"
    # Cannot use release tags, see https://github.com/aslafy-z/helm-git/issues/9
    # url: "git+https://github.com/istio/istio@install/kubernetes/helm?ref=1.3.0"
    url: "git+https://github.com/istio/istio@install/kubernetes/helm?ref=c2bd59595ce699b31d0f931885f023028ff7902b"

releases:

  #######################################################################################
  ## istio-init                                                                        ##
  ## istio is a service mesh for Kubernetes. istio-init installs the CRDs it needs.    ##
  #######################################################################################

  #
  # References:
  #   - https://github.com/istio/istio/tree/1.1.4/install/kubernetes/helm/istio-init
  #   - https://github.com/istio/istio
  #
  - name: "istio-init"
    namespace: "istio-system"
    labels:
      chart: "istio-init"
      repo: "github"
      component: "istio"
      namespace: "istio-system"
      vendor: "istio"
      default: "true"
    chart: "istio/istio-init"
    version: "1.1.0"
    wait: true
    installed: {{ env "ISTIO_INSTALLED" | default "true" }}
    values:
    - certmanager:
        enabled: {{ env "ISTIO_CERTMANAGER_ENABLED" | default "true" }}
      global:
        hub: "docker.io/istio"
        tag: "{{ coalesce (env "ISTIO_INIT_IMAGE_TAG") (env "ISTIO_IMAGE_TAG") "1.3.0" }}"
        pullPolicy: "IfNotPresent"
